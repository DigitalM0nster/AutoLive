generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model User {
    id           Int        @id @default(autoincrement()) @map("id")
    phone        String     @unique(map: "user_phone_unique") @map("phone") @db.VarChar(255)
    password     String     @map("password") @db.VarChar(255)
    first_name   String?    @map("first_name") @db.VarChar(255)
    last_name    String?    @map("last_name") @db.VarChar(255)
    middle_name  String?    @map("middle_name") @db.VarChar(255)
    role         Role       @map("role")
    status       UserStatus @default(unverified) @map("status")
    createdAt    DateTime   @default(now()) @map("created_at") @db.Timestamp(0)
    departmentId Int?       @map("department_id")

    // –°–≤—è–∑–∏
    department                   Department?        @relation("DepartmentUsers", fields: [departmentId], references: [id])
    managerOrders                Order[]            @relation("ManagerOrders")
    clientOrders                 Order[]            @relation("ClientOrders")
    createdOrders                Order[]            @relation("CreatedOrders")
    clientBookings               Booking[]          @relation("ClientBookings")
    managerBookings              Booking[]          @relation("ManagerBookings")
    technicalServicesResponsible TechnicalService[] @relation("TechnicalServiceResponsible")

    @@map("user")
}

model Category {
    id        Int      @id @default(autoincrement()) @map("id")
    title     String   @unique(map: "category_title_unique") @map("title") @db.VarChar(255)
    image     String?  @map("image") @db.VarChar(255)
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    order     Int      @default(0) @map("order")

    // –°–≤—è–∑–∏
    products           Product[]
    Filter             Filter[]
    markupRules        MarkupRule[]
    allowedDepartments DepartmentCategory[]

    @@map("category")
}

model Product {
    id            Int      @id @default(autoincrement()) @map("id")
    title         String   @map("title") @db.VarChar(255)
    sku           String   @map("sku") @db.VarChar(255)
    brand         String   @default("UNKNOWN") @map("brand") @db.VarChar(255)
    price         Float    @map("price")
    supplierPrice Float?   @map("supplier_price")
    description   String?  @map("description") @db.Text
    image         String?  @map("image") @db.VarChar(255)
    createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt     DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)
    categoryId    Int?     @map("category_id")
    departmentId  Int      @map("department_id")

    // –°–≤—è–∑–∏
    category            Category?              @relation(fields: [categoryId], references: [id], onDelete: SetNull)
    department          Department             @relation(fields: [departmentId], references: [id], onDelete: Cascade)
    productFilterValues ProductFilterValue[]
    analogsFrom         ProductAnalog[]        @relation("ProductToAnalog")
    analogsTo           ProductAnalog[]        @relation("AnalogToProduct")
    serviceKitItems     ServiceKitItem[]       @relation("KitItemProduct")
    analogInKitItems    ServiceKitItemAnalog[] @relation("KitItemAnalog")

    @@index([title])
    @@index([sku])
    @@index([brand])
    @@map("product")
}

model Filter {
    id         Int        @id @default(autoincrement()) @map("id")
    title      String     @map("title") @db.VarChar(255)
    type       FilterType @default(select) @map("type")
    unit       String?    @map("unit") @db.VarChar(50) // –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–ª—è range —Ñ–∏–ª—å—Ç—Ä–æ–≤
    categoryId Int        @map("category_id")

    // –°–≤—è–∑–∏
    category Category      @relation(fields: [categoryId], references: [id])
    values   FilterValue[]

    @@map("filter")
}

model FilterValue {
    id       Int    @id @default(autoincrement()) @map("id")
    value    String @map("value") @db.VarChar(255)
    filterId Int    @map("filter_id")

    // –°–≤—è–∑–∏
    filter              Filter               @relation(fields: [filterId], references: [id])
    productFilterValues ProductFilterValue[]

    @@map("filter_value")
}

model ProductFilterValue {
    id            Int @id @default(autoincrement()) @map("id")
    productId     Int @map("product_id")
    filterValueId Int @map("filter_value_id")

    // –°–≤—è–∑–∏
    product     Product     @relation(fields: [productId], references: [id])
    filterValue FilterValue @relation(fields: [filterValueId], references: [id])

    @@unique([productId, filterValueId], map: "product_filter_value_product_id_filter_value_id_unique")
    @@map("product_filter_value")
}

model ProductAnalog {
    id        Int @id @default(autoincrement()) @map("id")
    productId Int @map("product_id")
    analogId  Int @map("analog_id")

    // –°–≤—è–∑–∏
    product Product @relation("ProductToAnalog", fields: [productId], references: [id])
    analog  Product @relation("AnalogToProduct", fields: [analogId], references: [id])

    @@unique([productId, analogId], map: "product_analog_product_id_analog_id_unique")
    @@map("product_analog")
}

model ServiceKit {
    id          Int      @id @default(autoincrement()) @map("id")
    title       String   @map("title") @db.VarChar(255)
    description String?  @map("description") @db.Text
    image       String?  @map("image") @db.VarChar(255)
    price       Float    @map("price")
    createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)

    // –°–≤—è–∑–∏
    kitItems       ServiceKitItem[]
    serviceKitLogs ServiceKitLog[]

    @@map("service_kit")
}

model ServiceKitItem {
    id         Int @id @default(autoincrement()) @map("id")
    kit_id     Int @map("kit_id")
    product_id Int @map("product_id")

    // –°–≤—è–∑–∏
    kit     ServiceKit             @relation(fields: [kit_id], references: [id], onDelete: Cascade)
    product Product                @relation("KitItemProduct", fields: [product_id], references: [id], onDelete: Cascade)
    analogs ServiceKitItemAnalog[]

    @@map("service_kit_item")
}

// –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–Ω–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞
model ServiceKitItemAnalog {
    id               Int @id @default(autoincrement()) @map("id")
    serviceKitItemId Int @map("service_kit_item_id")
    analogProductId  Int @map("analog_product_id")

    // –°–≤—è–∑–∏
    serviceKitItem ServiceKitItem @relation(fields: [serviceKitItemId], references: [id], onDelete: Cascade)
    analogProduct  Product        @relation("KitItemAnalog", fields: [analogProductId], references: [id], onDelete: Cascade)

    @@unique([serviceKitItemId, analogProductId], map: "service_kit_item_analog_unique")
    @@map("service_kit_item_analog")
}

model ServiceKitLog {
    id           Int      @id @default(autoincrement()) @map("id")
    createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    action       String   @db.VarChar(255) // "create", "update", "delete"
    message      String?  @db.Text
    serviceKitId Int      @map("service_kit_id")

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    adminSnapshot      Json? // –ê–¥–º–∏–Ω –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
    serviceKitSnapshot Json? // –°–Ω–∞–ø—à–æ—Ç –∫–æ–º–ø–ª–µ–∫—Ç–∞ –¢–û

    // –°–≤—è–∑–∏
    serviceKit ServiceKit @relation(fields: [serviceKitId], references: [id], onDelete: Cascade)

    @@map("service_kit_log")
}

model Order {
    id                  Int         @id @default(autoincrement()) @map("id")
    comments            String[]    @map("comments")
    status              OrderStatus @default(created) @map("status")
    createdAt           DateTime    @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt           DateTime    @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)
    confirmationDate    DateTime?   @map("confirmation_date") @db.Timestamp(0)
    finalDeliveryDate   DateTime?   @map("final_delivery_date") @db.Timestamp(0)
    assignedAt          DateTime?   @map("assigned_at") @db.Timestamp(0) // –ö–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –±—ã–ª –≤–∑—è—Ç –≤ —Ä–∞–±–æ—Ç—É
    managerId           Int?        @map("manager_id") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ - –º–æ–∂–µ—Ç –±—ã—Ç—å null –¥–ª—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
    departmentId        Int?        @map("department_id") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ - –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–µ—Ç –±—ã—Ç—å null
    clientId            Int?        @map("client_id") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ - –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å null
    createdBy           Int?        @map("created_by") // –ö—Ç–æ —Å–æ–∑–¥–∞–ª –∑–∞–∫–∞–∑ (–∞–¥–º–∏–Ω/–º–µ–Ω–µ–¥–∂–µ—Ä/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å). –î–ª—è –ø—É–±–ª–∏—á–Ω–æ–π –∑–∞—è–≤–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å null
    bookingId           Int?        @unique @map("booking_id") // –°–≤—è–∑—å —Å –∑–∞—è–≤–∫–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É)
    bookingDepartmentId Int?        @map("booking_department_id") // –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

    // –°–≤—è–∑–∏
    manager           User?              @relation("ManagerOrders", fields: [managerId], references: [id])
    department        Department?        @relation(fields: [departmentId], references: [id])
    client            User?              @relation("ClientOrders", fields: [clientId], references: [id])
    creator           User?              @relation("CreatedOrders", fields: [createdBy], references: [id])
    booking           Booking?           @relation("OrderBooking", fields: [bookingId], references: [id])
    bookingDepartment BookingDepartment? @relation("OrderBookingDepartment", fields: [bookingDepartmentId], references: [id])
    technicalService  TechnicalService?  @relation("OrderTO")
    orderItems        OrderItem[]
    orderLogs         OrderLog[]

    @@map("order")
}

// –°–≤—è–∑–∞–Ω–Ω–æ–µ –¢–û (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ): –Ω–æ–º–µ—Ä, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π; –æ–¥–∏–Ω –∑–∞–∫–∞–∑ ‚Äî –æ–¥–Ω–æ –¢–û
model TechnicalService {
    id                Int      @id @default(autoincrement()) @map("id")
    number            String   @map("number") @db.VarChar(255) // –ù–æ–º–µ—Ä –¢–û
    orderId           Int?     @unique @map("order_id") // –°–≤—è–∑—å —Å –∑–∞–∫–∞–∑–æ–º (–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É)
    responsibleUserId Int?     @map("responsible_user_id") // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –¢–û
    createdAt         DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt         DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)

    order           Order? @relation("OrderTO", fields: [orderId], references: [id], onDelete: Cascade)
    responsibleUser User?  @relation("TechnicalServiceResponsible", fields: [responsibleUserId], references: [id], onDelete: SetNull)

    @@map("technical_service")
}

model OrderItem {
    id                   Int       @id @default(autoincrement()) @map("id")
    orderId              Int       @map("order_id")
    product_sku          String    @db.VarChar(255)
    product_title        String    @db.VarChar(255)
    product_price        Float
    product_brand        String    @db.VarChar(255)
    product_image        String?   @db.VarChar(255)
    quantity             Int       @default(1)
    supplierDeliveryDate DateTime? @map("supplier_delivery_date") @db.Timestamp(0) // –î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º
    carModel             String?   @map("car_model") @db.VarChar(255) // –ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
    vinCode              String?   @map("vin_code") @db.VarChar(255) // VIN-–∫–æ–¥ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

    // –°–≤—è–∑–∏
    order Order @relation(fields: [orderId], references: [id])

    @@map("order_item")
}

model Department {
    id        Int      @id @default(autoincrement()) @map("id")
    name      String   @map("name") @db.VarChar(255)
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)

    // –°–≤—è–∑–∏
    users             User[]               @relation("DepartmentUsers")
    products          Product[]
    orders            Order[]
    markupRules       MarkupRule[]
    allowedCategories DepartmentCategory[]

    @@map("department")
}

model DepartmentCategory {
    id           Int @id @default(autoincrement())
    departmentId Int @map("department_id")
    categoryId   Int @map("category_id")

    // –°–≤—è–∑–∏
    department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
    category   Category   @relation(fields: [categoryId], references: [id], onDelete: Cascade)

    @@unique([departmentId, categoryId], map: "department_category_department_id_category_id_unique")
    @@map("department_category")
}

model MarkupRule {
    id           Int      @id @default(autoincrement()) @map("id")
    departmentId Int?     @map("department_id")
    categoryId   Int?     @map("category_id")
    brand        String?  @map("brand") @db.VarChar(255)
    priceFrom    Float    @default(0) @map("price_from")
    priceTo      Float?   @map("price_to")
    markup       Float    @default(1) @map("markup")
    createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(0)

    // –°–≤—è–∑–∏
    department Department? @relation(fields: [departmentId], references: [id])
    category   Category?   @relation(fields: [categoryId], references: [id])

    @@map("markup_rule")
}

model bulk_action_log {
    id         Int      @id @default(autoincrement())
    created_at DateTime @default(now()) @db.Timestamp(0)
    action     String   @db.VarChar(255)
    message    String?  @db.Text
    count      Int

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    user_snapshot        Json? // –°–æ–¥–µ—Ä–∂–∏—Ç {id, first_name, last_name, role, department}
    departments_snapshot Json? // –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤ –∏–∑ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ [{id, name}, ...]
    products_snapshot    Json? // –ú–∞—Å—Å–∏–≤ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

}

model department_log {
    id              Int      @id @default(autoincrement())
    created_at      DateTime @default(now()) @db.Timestamp(0)
    actions         String   @db.Text
    message         String?  @db.Text
    user_id         Int?
    department_id   Int
    snapshot_before String?  @db.Text
    snapshot_after  String?  @db.Text
    admin_snapshot  String?  @db.Text

    // üÜï –ù–æ–≤—ã–µ Json –ø–æ–ª—è –¥–ª—è —Å–Ω–∏–º–∫–æ–≤
    user_snapshot       Json?
    department_snapshot Json?
}

model import_log {
    id            Int      @id @default(autoincrement())
    fileName      String   @map("file_name") @db.VarChar(255)
    created       Int
    updated       Int
    skipped       Int      @default(0)
    imagePolicy   String?  @map("image_policy") @db.VarChar(255)
    markupSummary String?  @map("markup_summary") @db.VarChar(255)
    markupData    Json?    @map("markup_data") // –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞—Ü–µ–Ω–∫–∞—Ö
    createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    message       String?  @db.Text
    count         Int

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    userSnapshot       Json? @map("user_snapshot") // –°–æ–¥–µ—Ä–∂–∏—Ç {id, first_name, last_name, role, department}
    departmentSnapshot Json? @map("department_snapshot") // –°–æ–¥–µ—Ä–∂–∏—Ç {id, name, created_at}
    productsSnapshot   Json? @map("products_snapshot") // –ú–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
}

model price_format {
    id          Int      @id @default(autoincrement())
    supplier_id Int
    columns     String
    created_at  DateTime @default(now()) @db.Timestamp(0)
}

model product_log {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    action    String   @db.VarChar(255)
    message   String?  @db.Text

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    userSnapshot            Json? @map("user_snapshot") // –°–æ–¥–µ—Ä–∂–∏—Ç {id, first_name, last_name, role, department}
    departmentSnapshot      Json? @map("department_snapshot") // –°–æ–¥–µ—Ä–∂–∏—Ç {id, name}
    productSnapshot         Json? @map("product_snapshot") // –°–æ–¥–µ—Ä–∂–∏—Ç {id, title, price, sku, brand}
    productSnapshotBefore   Json? @map("product_snapshot_before") // –ü–æ–ª–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç —Ç–æ–≤–∞—Ä–∞ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    productSnapshotAfter    Json? @map("product_snapshot_after") // –ü–æ–ª–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

    // üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ)
    importLogId Int? @map("import_log_id")
}

model sms_code {
    id         Int      @id @default(autoincrement())
    phone      String   @db.VarChar(255)
    code       String   @db.VarChar(10)
    expires_at DateTime @default(now()) @db.Timestamp(0)
    used       Boolean  @default(false)
    created_at DateTime @default(now()) @db.Timestamp(0)
}

model supplier {
    id         Int      @id @default(autoincrement())
    name       String   @db.VarChar(255)
    created_at DateTime @default(now()) @db.Timestamp(0)
}

model Promotion {
    id          Int      @id @default(autoincrement())
    title       String   @db.VarChar(255)
    description String?  @db.Text
    image       String?  @db.VarChar(255)
    buttonText  String?  @db.VarChar(255)
    buttonLink  String?  @db.VarChar(255)
    order       Int      @default(0)
    createdAt   DateTime @default(now()) @db.Timestamp(0)
    updatedAt   DateTime @default(now()) @updatedAt @db.Timestamp(0)
}

model user_log {
    id         Int      @id @default(autoincrement())
    created_at DateTime @default(now()) @db.Timestamp(0)
    action     String   @db.VarChar(255)
    message    String?  @db.Text

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    admin_snapshot       Json? // –ê–¥–º–∏–Ω –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
    target_user_snapshot Json? // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–¥ –∫–æ—Ç–æ—Ä—ã–º —Å–æ–≤–µ—Ä—à–∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ
    department_snapshot  Json? // –û—Ç–¥–µ–ª
}

model OrderLog {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    action    String   @db.VarChar(255) // "create", "update", "assign", "status_change", "cancel"
    message   String?  @db.Text
    orderId   Int      @map("order_id")

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    adminSnapshot      Json? // –ê–¥–º–∏–Ω –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
    orderSnapshot      Json? // –°–Ω–∞–ø—à–æ—Ç –∑–∞–∫–∞–∑–∞
    managerSnapshot    Json? // –°–Ω–∞–ø—à–æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ)
    departmentSnapshot Json? // –°–Ω–∞–ø—à–æ—Ç –æ—Ç–¥–µ–ª–∞

    // –°–≤—è–∑–∏
    order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

    @@map("order_log")
}

// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π
model ChangeLog {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())

    // –¢–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–º–µ–Ω—è–ª–∞—Å—å
    entityType String // "user", "department", "product", "order", "category"

    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
    message String?

    // –ü–æ–ª–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö
    snapshotBefore Json? // –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –î–û –∏–∑–º–µ–Ω–µ–Ω–∏–π
    snapshotAfter  Json? // –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –ü–û–°–õ–ï –∏–∑–º–µ–Ω–µ–Ω–∏–π
    adminSnapshot  Json? // –ü–æ–ª–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∫—Ç–æ —Å–æ–≤–µ—Ä—à–∏–ª –¥–µ–π—Å—Ç–≤–∏–µ)

    // –ú–∞—Å—Å–∏–≤ –¥–µ–π—Å—Ç–≤–∏–π (–¥–ª—è –æ—Ç–¥–µ–ª–æ–≤)
    actions Json? // ["add_employees", "change_name", ...]

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–∏—Å–∫–∞
    entityId     Int? // ID –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)
    adminId      Int? // ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)
    departmentId Int? // ID –æ—Ç–¥–µ–ª–∞ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)
}

enum Role {
    superadmin
    admin
    manager
    client
}

enum UserStatus {
    unverified
    verified
}

enum FilterType {
    select
    multi_select
    range
    boolean
}

model BookingDepartment {
    id        Int      @id @default(autoincrement()) @map("id")
    name      String?  @map("name") @db.VarChar(255) // –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ –¥–ª—è –∑–∞–ø–∏—Å–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    address   String   @map("address") @db.Text // –ê–¥—Ä–µ—Å –æ—Ç–¥–µ–ª–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    phones    String[] @map("phones") // –ú–∞—Å—Å–∏–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ 100 —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤)
    emails    String[] @map("emails") // –ú–∞—Å—Å–∏–≤ –ø–æ—á—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—á—Ç)
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)

    // –°–≤—è–∑–∏
    bookings              Booking[]
    orders                Order[]                @relation("OrderBookingDepartment")
    bookingDepartmentLogs BookingDepartmentLog[]

    @@map("booking_department")
}

model BookingDepartmentLog {
    id                  Int      @id @default(autoincrement()) @map("id")
    createdAt           DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    action              String   @db.VarChar(255) // "create", "update", "delete"
    message             String?  @db.Text
    bookingDepartmentId Int      @map("booking_department_id")

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    adminSnapshot             Json? // –ê–¥–º–∏–Ω –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
    bookingDepartmentSnapshot Json? // –°–Ω–∞–ø—à–æ—Ç –æ—Ç–¥–µ–ª–∞

    // –°–≤—è–∑–∏
    bookingDepartment BookingDepartment @relation(fields: [bookingDepartmentId], references: [id], onDelete: Cascade)

    @@map("booking_department_log")
}

model Booking {
    id                  Int           @id @default(autoincrement()) @map("id")
    scheduledDate       DateTime      @map("scheduled_date") @db.Date
    scheduledTime       String        @map("scheduled_time") @db.VarChar(10) // –§–æ—Ä–º–∞—Ç: "14:30"
    contactPhone        String        @map("contact_phone") @db.VarChar(255) // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ - —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏
    clientId            Int?          @map("client_id") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ - –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
    managerId           Int?          @map("manager_id") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ - –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ
    bookingDepartmentId Int           @map("booking_department_id") // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ - –æ—Ç–¥–µ–ª –¥–ª—è –∑–∞–ø–∏—Å–∏
    orderId             Int?          @map("order_id") // –°–≤—è–∑—å —Å –∑–∞–∫–∞–∑–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    status              BookingStatus @default(scheduled) @map("status")
    notes               String?       @map("notes") @db.Text // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è, —Ç–∏–ø —É—Å–ª—É–≥–∏ –∏ —Ç.–¥.
    createdAt           DateTime      @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt           DateTime      @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)

    // –°–≤—è–∑–∏
    client            User?             @relation("ClientBookings", fields: [clientId], references: [id])
    manager           User?             @relation("ManagerBookings", fields: [managerId], references: [id])
    bookingDepartment BookingDepartment @relation(fields: [bookingDepartmentId], references: [id])
    order             Order?            @relation("OrderBooking")
    bookingLogs       BookingLog[]

    @@map("booking")
}

enum OrderStatus {
    created // –ù–æ–≤—ã–π
    confirmed // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
    booked // –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω
    ready // –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ
    paid // –û–ø–ª–∞—á–µ–Ω
    completed // –í—ã–ø–æ–ª–Ω–µ–Ω
    returned // –í–æ–∑–≤—Ä–∞—Ç
}

enum BookingStatus {
    scheduled // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞
    confirmed // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
    completed // –í—ã–ø–æ–ª–Ω–µ–Ω–∞
    cancelled // –û—Ç–º–µ–Ω–µ–Ω–∞
    no_show // –ù–µ —è–≤–∏–ª—Å—è
}

model BookingLog {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    action    String   @db.VarChar(255) // "create", "update", "assign", "status_change", "cancel"
    message   String?  @db.Text
    bookingId Int      @map("booking_id")

    // üì∏ –°–Ω–∏–º–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è ID)
    adminSnapshot      Json? // –ê–¥–º–∏–Ω –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ
    bookingSnapshot    Json? // –°–Ω–∞–ø—à–æ—Ç –∑–∞–ø–∏—Å–∏
    managerSnapshot    Json? // –°–Ω–∞–ø—à–æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ)
    departmentSnapshot Json? // –°–Ω–∞–ø—à–æ—Ç –æ—Ç–¥–µ–ª–∞

    // –°–≤—è–∑–∏
    booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)

    @@map("booking_log")
}

// –ö–æ–Ω—Ç–µ–Ω—Ç –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
model HomepageContent {
    id                  Int      @id @default(autoincrement()) @map("id")
    firstBlockTitle     String   @default("–í—ã–±—Ä–∞—Ç—å –∑–∞–ø—á–∞—Å—Ç–∏ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º:") @map("first_block_title") @db.VarChar(255)
    callButtonText      String   @default("–ü–æ–∑–≤–æ–Ω–∏—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω") @map("call_button_text") @db.VarChar(255)
    orderButtonText     String   @default("–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑") @map("order_button_text") @db.VarChar(255)
    formFields          Json     @default("[]") @map("form_fields") // –ú–∞—Å—Å–∏–≤ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
    formSubmitButtonText String  @default("–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑") @map("form_submit_button_text") @db.VarChar(255)
    createdAt           DateTime @default(now()) @map("created_at") @db.Timestamp(0)
    updatedAt           DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(0)

    @@map("homepage_content")
}
